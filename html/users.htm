<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=windows-1251">
<title>Выбор пользователя</title>
<link rel="stylesheet" href="style/style.css">

<script type="text/javascript" src="js/Ajax.js"></script>
<script type="text/javascript" src="js/Base64.js"></script>
<script type="text/javascript" src="js/script.js"></script>

<script>

var timeShedules;
var serverCurrentDate = Ajax.runEval("/script/enterTheme.exe?getServerCurrentDate");
var serverDate = Ajax.runEval("/script/enterTheme.exe?getCurrentDate");
var currentDate = new Date(serverDate.currentDate);
var user;

function onLoad()
{
	user = Ajax.runEval("/script/login.exe?user");
	
	if (((eval(user.userStatusCode) >= 2) & (eval(user.userStatusCode) <= 6)) || (eval(user.userStatusCode) == 14) || (eval(user.userStatusCode) == 16) || (eval(user.userStatusCode) == 17) || (eval(user.userStatusCode) == 100)) {
		//Текущая дата
		getCurrentDate();
		
		//Текущий пользователь
		setCurrentUser();
			
		//Получаем названия статусов пользователей в системе
		var status = document.getElementById("status");
		status.innerHTML = "";
		var statuses = Ajax.runEval("/script/enterTheme.exe?getStatus");
	
		status.options[0] = new Option("Любой", 0);	
	
		//Статус пользователя в системе
		for(var i = 0; i < statuses.length; i++)
		{
			status.options[status.options.length] = new Option(statuses[i].statusName, statuses[i].statusCode);	
		}
		
		status.value = 4;
		//getStatusTheme();
		getPlannedShedule();
		statusChanged();			
	}
	else {
		alert("Вы не имеете права работы с данным режимом! ");
		location.replace("/login?&/users.htm");
	}
	
}

/*function getStatusTheme()
{
	timeShedules = Ajax.runEval("/script/enterTheme.exe?getPlannedShedule");
	
	var statusTheme = document.getElementById("statusTheme");
	statusTheme.innerHTML = "";
	var statusThemes = Ajax.runEval("/script/enterTheme.exe?getStatusTheme");

	statusTheme.options[0] = new Option("Любой", 0);	

	//Статус пользователя в системе
	for(var i = 0; i < statusThemes.length; i++)
	{
		statusTheme.options[statusTheme.options.length] = new Option(statusThemes[i].statusThemeName, statusThemes[i].statusThemeCode);	
	}
}*/


function getPlannedShedule()
{
	timeShedules = Ajax.runEval("/script/enterTheme.exe?getPlannedShedule");
	
	var result = "<div align=\"center\">";
	result += "<table border=\"1\" width=\"100%\" style=\"background: white;\">";
	result += "<tr>";
	result += "<td align=\"left\" valign=\"top\">" + "№п/п" + "</td>";
	result += "<td align=\"left\" valign=\"top\">" + "Название этапа" + "</td>";
	result += "<td align=\"left\" valign=\"top\">" + "Плановый срок выполнения" + "</td>";
	
	for(var i = 0; i < timeShedules.length; i++) {
		result += "<tr>";
		result += "<td align=\"left\" valign=\"top\">" + String(i+1) + "</td>";
		result += "<td align=\"left\" valign=\"top\">" + timeShedules[i].timeSheduleStageName + "</td>";
		result += "<td align=\"left\" valign=\"top\">" + timeShedules[i].timeSheduleDateExecute + "</td>";
		result += "</tr>";
	}
	
	result += "</table>";
	result += "</div>";
	document.getElementById("plannedShedule").innerHTML = result;
}

// Перевод строки Дд.Мм.ВвГг в формат даты
function StrToDate(Dat) {
   var year=Number(Dat.split(".")[2])
   var month=Number(Dat.split(".")[1])
   var day=Number(Dat.split(".")[0])
   var dat= new Date(year,month,day)
   return dat
}

function statusChanged()
{
	document.getElementById("statusList").innerHTML = "";
	var userStatusCode = document.getElementById("status").value;
	//var userStatusThemeCode = document.getElementById("statusTheme").value;
	
	
	var xhr = new XMLHttpRequest();		
	xhr.open("GET", "/script/enterTheme.exe?getStatusList&" + userStatusCode, true);
	xhr.send();
	xhr.onreadystatechange = function() {
		if (xhr.readyState != 4) return;
		if (xhr.status != 200) {
			alert("Error");
		} 
		else {
			var s = eval(xhr.responseText);
			getStatusList(s, userStatusCode);
		}
	}	
}	
	
function getStatusList(statusList, userStatusCode)	
{	
	//alert(userStatusCode);
	
	if (eval(userStatusCode) != 17) {
		var currentStageExecuteCode = 0; //Номер текущего этапа выполнения проекта
		var plannedStageExecuteCode = 0; //Номер этапа из графика
		var stageExecuteDate; //Дата выполнения конкретного этапа (по графику)
		
		var result = "<div align=\"center\">";
		result += "<table border=\"1\" width=\"80%\" style=\"background: white;\" id=\"resultStatusList\">";
		result += "<tr>";
		result += "<td align=\"left\" style=\"background: #FFAE5E;\" valign=\"top\">" + "№п/п" + "</td>";
		
		result += "<td align=\"left\" style=\"background: #FFAE5E;\" valign=\"top\">" + "Персональный код" + "</td>";
		
		result += "<td align=\"left\" style=\"background: #FFAE5E;\" valign=\"top\">" + "ФИО" + "</td>";
//		result += "<td align=\"left\" style=\"background: #FFAE5E;\" valign=\"top\">" + "" + "</td>";
		result += "<td align=\"left\" style=\"background: #FFAE5E;\" valign=\"top\">" + "Университет, НИИ, образовательный округ" + "</td>";
		
		result += "<td align=\"left\" style=\"background: #FFAE5E;\" valign=\"top\">" + "Название темы" + "</td>";
		
		result += "<td align=\"left\" style=\"background: #FFAE5E;\" valign=\"top\">" + "Кафедра, школа и др." + "</td>";
		
		result += "<td align=\"left\" style=\"background: #FFAE5E;\" valign=\"top\">" + "Должность" + "</td>";
		result += "<td align=\"left\" style=\"background: #FFAE5E;\" valign=\"top\">" + "Статус участника" + "</td>";		
		
//		result += "<td align=\"left\" style=\"background: #FFAE5E;\" valign=\"top\">" + "Этап выполнения работы" + "<b><span style=\"background-color: #FF0000\"> просроченные</span></b>" + "</td>";
		result += "<td align=\"left\" style=\"background: #FFAE5E;\" valign=\"top\">" + "Этап выполнения работы" + "</td>";
		
		result += "<td align=\"left\" style=\"background: #FFAE5E;\" valign=\"top\">" + "Статус темы проекта" + "</td>";
		
		result += "<td align=\"left\" style=\"background: #FFAE5E;\" valign=\"top\">" + "Дата присвоения статуса" + "</td>";
		
		result += "</tr>";			
		
		for(var i = 0; i < statusList.length; i++)
		{
			result += "<tr>";
			result += "<td align=\"left\" valign=\"top\">" + String(i+1) + "</td>";
			
			result += "<td align=\"left\" valign=\"top\">" + statusList[i].statusListCode + "</td>";
			
			result += "<td align=\"left\" valign=\"top\">";
			result += "<a href=\"javascript:getThemesByUser('" + statusList[i].statusListFIO + "'," + statusList[i].statusListCode + ", " + userStatusCode + ");\">" + statusList[i].statusListFIO + "</a>";

			result += "</td>";
			result += "<td align=\"left\" valign=\"top\">" + statusList[i].statusListOrganizationName + "</td>";
			
			result += "<td align=\"left\" valign=\"top\">" + statusList[i].statusListThemeName + "</td>";
			
			result += "<td align=\"left\" valign=\"top\">" + statusList[i].statusListSubdivisionLevel1Name + "</td>";
			
			result += "<td align=\"left\" valign=\"top\">" + statusList[i].statusListPostName + "</td>";
			
			result += "<td align=\"left\" valign=\"top\">" + statusList[i].statusListStatusName + "</td>";
		
			
			//раскраска этапов выполнения работы (в зависимости от того, просрочен ли этап или нет)
			/*for(var j = 0 ; j < timeShedules.length; j++) {
				//Получили номер текущего этапа (из темы)
				currentStageExecuteCode = statusList[i].statusListCurrentStageCode;
				
				//Получаем номера этапа из графика (для сравнения)
				plannedStageExecuteCode = timeShedules[j].timeSheduleCode;
				
				//Теперь сравниваем этапы
				if (currentStageExecuteCode == plannedStageExecuteCode) {
					//Преобразовываем строку с датой в дату
					stageExecuteDate = new Date(StrToDate(timeShedules[j].timeSheduleDateExecute));
					
					//Теперь сравниваем даты - текущую и ту, которая в графике
					if (currentDate < stageExecuteDate) {
						result += "<td style=\"background: #33FF99;\" align=\"left\" valign=\"top\">" + statusList[i].statusListCurrentStageExecute + "</td>";
					}
					else {*/
						//result += "<td style=\"background: red;\" align=\"left\" valign=\"top\">" + statusList[i].statusListCurrentStageExecute + "</td>";
						result += "<td align=\"left\" valign=\"top\">" + statusList[i].statusListCurrentStageExecute + "</td>";

					/*}
				}
			}*/
			
			//Раскраска статуса темы
			switch (eval(statusList[i].statusListStatusThemeCode)) {
				case 1:
					result += "<td align=\"left\" valign=\"top\" style=\"background: purple; color: white;\">" + statusList[i].statusListStatusThemeName + "</td>";		
				break;
				
				case 6:
					result += "<td align=\"left\" valign=\"top\" style=\"background: yellow; color: black;\">" + statusList[i].statusListStatusThemeName + "</td>";		
				break;
				
				case 5:
					result += "<td align=\"left\" valign=\"top\" style=\"background: red; color: white;\">" + statusList[i].statusListStatusThemeName + "</td>";		
				break;
				
				case 9:
					result += "<td align=\"left\" valign=\"top\" style=\"background: yellow; color: black;\">" + statusList[i].statusListStatusThemeName + "</td>";		
				break;
				
				case 2:
					result += "<td align=\"left\" valign=\"top\" style=\"background: green; color: white;\">" + statusList[i].statusListStatusThemeName + "</td>";		
				break;
				
				case 3:
					result += "<td align=\"left\" valign=\"top\" style=\"background: #E0FFFF; color: white;\">" + statusList[i].statusListStatusThemeName + "</td>";		
				break;
				
				case 7:
					result += "<td align=\"left\" valign=\"top\" style=\"background: #FFE4C4; color: white;\">" + statusList[i].statusListStatusThemeName + "</td>";		
				break;
				
				default:
					result += "<td align=\"left\" valign=\"top\">" + statusList[i].statusListStatusThemeName + "</td>";		
				break;
			}
			
			
			result += "<td align=\"left\" valign=\"top\">" + statusList[i].statusListThemeDateTimeUpdateStatus + "</td>";
			
			
			result += "</tr>";
		}
		
		result += "</table>";
		result += "</div>";
		document.getElementById("statusList").innerHTML = result;
	}
	else {
		//alert(123);
	}
	
	TABLE_SORT(document.getElementById("resultStatusList"));

}

function getThemesByUser(userFIO, userCode, userStatusCode)
{
	//var newWin = window.open("userThemes.htm?statusCode=" + userCode + "&" + "userFIO=" + userFIO);
	location.href = "userThemes.htm?userCode=" + userCode + "&" + "userStatusCode=" + userStatusCode + "&" + "userFIO=" + Base64.encode(userFIO);
}


</script>




</head>

<body onload="onLoad();" style="background-attachment: fixed; background-size: 100% auto; text-align:center" bgcolor="#DCF7FF">

		

<div align="center">
	&nbsp;<table border="0" width="1844" id="table5">
		<tr>
			<td align="right" valign="top" width="191">&nbsp;</td>
			<td align="left" valign="top" width="149">
			<img border="0" src="img/coat_of_arms_SO.gif" width="149" height="148"></td>
			<td align="left" valign="top" width="1490">
			<p align="center" style="margin-top: 0; margin-bottom: 0"><b>
			<font style="font-size: 23pt">Самарская 
			научно-образовательная программа 
			<span style="font-size: 23pt">«ВЗЛЕТ» </span>
			</font></b></p>
			<p align="center" style="margin-top: 0; margin-bottom: 0"><b>
			<font style="font-size: 23pt">конкурсного отбора в
			<span style="font-size: 23pt">
			Губернаторский реестр творчески одаренной молодежи</span></font></b></p>
			<p align="center" style="margin-top: 0; margin-bottom: 0"><b>
			<font style="font-size: 23pt">
			<span style="font-size: 23pt">в сфере науки и техники </span>
			</font></b></p>
			<p>&nbsp;</td>
		</tr>
	</table>
</div>
		<div align="center">

&nbsp;<table width="84%" id="table15" border="0" cellpadding="0" align="center">
	<tr>
 		<!--<td align="center" style="font-size: 150%"><a href="conf/2014/index.htm">Международная научно-практическая конференция "ТВОРЧЕСКИЙ ПОТЕНЦИАЛ-2014"</a></td> -->
		<!--<td align="center" style="font-size: 150%"><a href="regionalConferences.htm">Региональная коференция "ТВОРЧЕСКИЙ ПОТЕНЦИАЛ-2014" ИСТ СГАСУ</a></td> -->		
		<!-- <td align="center" style="font-size: 150%"><a href="#">Архив исследовательской проектов школьников и студентов - участников АСВ (в разработке)</a></td> -->
		<td align="center" style="font-size: 150%" width="1%">
		<span style="font-size: 16pt">
		<div align="center">
			<table border="0" width="100%" id="table16">
				<tr>
					<td align="center">
					<p style="margin-top: 0; margin-bottom: 0"><b>
					<a href="index.html">Главная</a></b></td>
					<!--<td align="center">
					<p style="margin-top: 0; margin-bottom: 0"><b>
					<a href="about.html">О программе &quot;ВЗЛЕТ&quot;</a></b></td>-->
					<td align="center">
					<p style="margin-top: 0; margin-bottom: 0"><b>
					<a href="allUsers.htm">Участники программы</a></b></td>
					<td align="center">
					<a href="enterInfo.htm"><p style="margin-top: 0; margin-bottom: 0"><b>
					Ввод тематики<span lang="ru">,</span> запросов<span lang="ru">,</span> 
					коллективов</b></a></td>
					<td align="center">
					<p style="margin-top: 0; margin-bottom: 0"><b>
					<a href="chooseTheme.htm">Выбор тематики и&nbsp;формирование 
					коллективов</a></b></td>
					<td align="center" bgcolor="#FFFF00">
					<p style="margin-top: 0; margin-bottom: 0">
					<a href="viewEnter.htm"><span lang="ru"><b>П</b></span><b>росмотр<span lang="ru"> 
					и ввод</span> информации о ходе исследования</b></a></td>
					<td align="center">
					<span style="font-size: 12pt">
					<p style="margin-top: 0; margin-bottom: 0"><b>
					<a href="events.htm">Запишись и участвуй</a></b></td>
					<td align="center">
					<p style="margin-top: 0; margin-bottom: 0"><b>
					<a href="monitoringThemes.htm">Мониторинг хода&nbsp;исследований</a></b></td>
					<td align="center">
					<p style="margin-top: 0; margin-bottom: 0"><b>
					<a href="contest.html">Региональный конкурс &quot;ВЗЛЕТ&quot;</a></b></td>
					<td align="center">
					<p style="margin-top: 0; margin-bottom: 0">
					<span style="font-size: 12pt">
					<b>
					<a href="enterInfo1.htm">Достижения в других 
					конкурсах/конференциях</a></b></td>
				</tr>
			</table>
		</div>
		</td>
	</tr>
</table>


				<div name="currentUser">
					<p style="margin-left: 100px; margin-right: 100px" align="right">
					<font color="#FFFFFF"><b>
					<span style="font-size: 12pt; background-color: #000080" id="currentUser">0</span></b></font><span style="font-size: 16pt">
				</div>


				<p align="right" style="margin-top: 0; margin-bottom: 0; margin-right:50px">
				<font style="font-size: 14pt">
				<span id="currentDate" style="font-weight: 400; font-style: italic; ">001</span></font></p>
		<p>&nbsp;</div>
		<p style="text-align: right; margin-top:0; margin-bottom:0">&nbsp;</p>
		<table border="1" width="95%" id="table3">
			<tr>
				<td align="left" width="5%" valign="top">&nbsp;</td>
				<td align="left" width="70%" valign="top">
				<span style="font-size: 16pt">
				<p align="center" style="margin-top: 0; margin-bottom: 0">
				<font color="#FF0000"><b>Н<span lang="ru">АПОМИНАЕМ</span><span lang="en-us">:</span>
				<span lang="ru">
				ИСПОЛЬЗУЙТЕ ЛЮБОЙ БРАУЗЕР, КРОМЕ </span>
				<span lang="en-us">INTERNET EXPLORER</span>.<span lang="ru">
				</span></b></font></p>
				<p align="center" style="margin-top: 0; margin-bottom: 0">
				<font color="#FF0000"><b><span lang="ru">
				БЕСПЛАТНО СКАЧАТЬ БРАУЗЕР, МОЖНО, НАПРИМЕР,
				<a href="https://download.mozilla.org/?product=firefox-stub&os=win&lang=ru">
				ЗДЕСЬ</a></span></b></font></p>
				<p align="center" style="margin-top: 0; margin-bottom: 0">
				&nbsp;</p>
				<p align="center" style="margin-top: 0; margin-bottom: 0">
				<font color="#0000FF"><b>Показываются темы во всех их текущих 
				статусах, в том числе и отклоненные консультантом</b></font></p>
				<p align="center" style="margin-top: 0; margin-bottom: 0">&nbsp;</p></span>
			<table border="1" width="80%" id="table4" bgcolor="#FFAE5E">
				<tr>
					<td align="left" valign="top" width="70%">
					Укажите <span lang="ru">интересующий Вас тип участников Программы</span></td>
					<td align="left" valign="top" width="30%">
					<select size="1" id="status" name="D1">
					</select></td>
				</tr>
				</table>
			<p align="center"><span id="statusList">222</span></td>
				<td align="left" width="30%" valign="top">
				<p align="center" style="margin-top: 0; margin-bottom: 0">
				<font size="3"><span style="font-weight: 700">Плановый график 
		выполнения индивидуального проекта в 2016/2017 году</span></font></p>
				<p align="center" style="margin-top: 0; margin-bottom: 0">
				<b>(за соблюдение сроков начисляются баллы 
				к&nbsp; творческому рейтингу ученика)</b></p>
				<p align="center" style="margin-top: 0; margin-bottom: 0">
				&nbsp;</p>
				<p align="center" style="margin-top: 0; margin-bottom: 0">
				<font size="3">
				<span id="plannedShedule" style="font-weight: 400">000</span></font></td>
			</tr>
</table>
		<p>&nbsp;</p>
		<div align="center">
			<p>&nbsp;
		</div>



</body>

</html>