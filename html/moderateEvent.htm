<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=windows-1251">
<title>Модерирование мероприятий</title>
<link rel="stylesheet" href="style/style.css">

<script type="text/javascript" src="js/Ajax.js"></script>
<script type="text/javascript" src="js/Base64.js"></script>
<script type="text/javascript" src="js/table_sort.js"></script>
<script type="text/javascript" src="js/script.js"></script>

<script>

function onLoad()
{
	user = Ajax.runEval("/script/login.exe?user");
	//Если аналитик или администратор
	if ((eval(user.userStatusCode) == 14) || (eval(user.userStatusCode) == 100)) {
		setCurrentUser();
		getScienceDirection();
		getOrganization();
	}
	else {
		location.replace("/login?&/moderateEvent.htm");
	}
	//chooseEvent();
}

function getScienceDirection()
{
	var scienceDirection = Ajax.runEval("/script/chooseEvent.exe?getScienceDirection");
	var sciDirection = document.getElementById("scienceDirection");

	//Научное направление 1
	for(var i = 0; i < scienceDirection.length; i++)
	{
		sciDirection.options[sciDirection.options.length] = new Option(scienceDirection[i].scienceDirectionName, scienceDirection[i].scienceDirectionCode);	
	}
}

function getOrganization()
{
	var organizations = Ajax.runEval("/script/chooseEvent.exe?getOrganization");
	var organization = document.getElementById("organization");

	//Организации
	for(var i = 0; i < organizations.length; i++)
	{
		organization.options[organization.options.length] = new Option(organizations[i].organizationName, organizations[i].organizationCode);	
	}
}


//Привязка к теме
function applyEvent(eventCode)
{
	location.href = "applicationEvent.htm?eventCode=" + eventCode;
}

function chooseEvent()
{
	document.getElementById("events").innerHTML = "";
	
	var scienceDirectionCode = document.getElementById("scienceDirection").value;
	var organizationCode = document.getElementById("organization").value;
	
	var xhr = new XMLHttpRequest();		
	xhr.open("GET", "/script/chooseEvent.exe?chooseEventModerate&" + scienceDirectionCode + "&" + organizationCode, true);
	xhr.send();
	xhr.onreadystatechange = function() {
		if (xhr.readyState != 4) return;
		if (xhr.status != 200) {
			alert("Error");
		} 
		else {
			var s = eval(xhr.responseText);
			getChooseEvent(s);
		}
	}	
}

function getChooseEvent(events)
{	
	var result = "<div align=\"center\">";
	result += "<table border=\"1\" width=\"80%\" style=\"background: white;\" id=\"resultTable\">";
	result += "<tr>";
	result += "<td align=\"left\" style=\"background: #FFAE5E;\" valign=\"top\">" + "№п/п" + "</td>";
	
	result += "<td align=\"left\" style=\"background: #FFAE5E;\" valign=\"top\">" + "ФИО ответственного за мероприятие" + "</td>";
	result += "<td align=\"left\" style=\"background: #FFAE5E;\" valign=\"top\">" + "Организация-участник" + "</td>";
	result += "<td align=\"left\" style=\"background: #FFAE5E;\" valign=\"top\">" + "Должность ответственного за мероприятие" + "</td>";

	result += "<td align=\"left\" style=\"background: #FFAE5E;\" valign=\"top\">" + "Название, место и дата проведения мероприятия (переход по щелчку)" + "</td>";
	result += "<td align=\"left\" style=\"background: #FFAE5E;\" valign=\"top\">" + "Краткое описание мероприятия" + "</td>";

	result += "<td align=\"left\" style=\"background: #FFAE5E;\" valign=\"top\">" + "Текст для отправки записавшемуся участнику мероприятия" + "</td>";
	
	result += "<td align=\"left\" style=\"background: #FFAE5E;\" valign=\"top\">" + "Связь с приоритетными направлениями и технологиями развития НТП страны и области" + "</td>";
	result += "<td align=\"left\" style=\"background: #FFAE5E;\" valign=\"top\">" + "Связь с предприятиями и организациями НТП области" + "</td>";
	
	result += "<td align=\"left\" style=\"background: #FFAE5E;\" valign=\"top\">" + "Направления науки" + "</td>";

	result += "<td align=\"left\" style=\"background: #FFAE5E;\" valign=\"top\">" + "Дата проведения мероприятия" + "</td>";
	result += "<td align=\"left\" style=\"background: #FFAE5E;\" valign=\"top\">" + "Статус мероприятия" + "</td>";
	result += "<td align=\"left\" style=\"background: #FFAE5E;\" valign=\"top\">" + "Одобрить мероприятие" + "</td>";
	result += "<td align=\"left\" style=\"background: #FFAE5E;\" valign=\"top\">" + "Удалить мероприятие" + "</td>";

	result += "</tr>";
	
	for(var i = 0; i < events.length; i++) {
		result += "<tr>";
		result += "<td align=\"left\" valign=\"top\"><font size=\"2\">" + String(i+1) + "</font></td>";
		
		
		result += "<td align=\"left\" valign=\"top\"><font size=\"2\">" + events[i].coordinatorFIO + "</font></td>";
		result += "<td align=\"left\" valign=\"top\"><font size=\"2\">" + events[i].organizationName + "</font></td>";
		result += "<td align=\"left\" valign=\"top\"><font size=\"2\">" + events[i].postName + "</font></td>";
		
		result += "<td align=\"left\" valign=\"top\"><font size=\"2\"><a href=\"javascript:applyEvent(" + events[i].eventCode + ");\">" + events[i].eventName + "</font></a></td>";
	
		result += "<td align=\"left\" valign=\"top\"><font size=\"2\">" + events[i].eventComment + "</font></td>";
		
		result += "<td align=\"left\" valign=\"top\"><font size=\"2\">" + events[i].eventTextToEMail + "</font></td>";
		
		result += "<td align=\"left\" valign=\"top\"><font size=\"2\">" + events[i].priorityDirectionName + "</font></td>";
		result += "<td align=\"left\" valign=\"top\"><font size=\"2\">" + events[i].scienceIndustrialSphereName + "</font></td>";
		
		result += "<td align=\"left\" valign=\"top\"><font size=\"2\">";
		
		if (String(events[i].eventScienceDirectionName1) != "Нет") {
			 result += events[i].eventScienceDirectionName1;
		}
		
		if (String(events[i].eventScienceDirectionName2) != "Нет") {
			result += ", " + events[i].eventScienceDirectionName2;
		}
		
		if (String(events[i].eventScienceDirectionName3) != "Нет") {
			 result += ", " + events[i].eventScienceDirectionName3 + "</font></td>";
		}

		result += "<td align=\"left\" valign=\"top\"><font size=\"2\">" + events[i].eventDate + "</font></td>";
		result += "<td align=\"left\" valign=\"top\"><font size=\"2\">" + events[i].statusEventName + "</font></td>";
		
		if (eval(events[i].eventMarkModerate) == 0) {
			result += "<td id=\"event" + events[i].eventCode + "\" align=\"left\" valign=\"top\"><font size=\"2\"><a href=\"javascript:eventApprove(" + events[i].eventCode + ");\">"  + "Одобрить" + "</a></font></td>";
		}
		else {
			result += "<td id=\"event" + events[i].eventCode + "\" align=\"left\" valign=\"top\"><font size=\"2\"><a href=\"javascript:eventBanShow(" + events[i].eventCode + ");\">"  + "Запретить к показу" + "</a></font></td>";
		}
		
		result += "<td id=\"event" + events[i].eventCode + "\" align=\"left\" valign=\"top\"><font size=\"2\"><a href=\"javascript:eventRemove(" + events[i].eventCode + ");\">"  + "Удалить мероприятие" + "</a></font></td>";
		
		
		result += "</tr>";
	}
	
	result += "</table>";
	result += "</div>";
	
	document.getElementById("events").innerHTML = result;	
	TABLE_SORT(document.getElementById("resultTable"));
}


//Одобрение мероприятия
function eventApprove(eventCode)
{
	var approveEvent = Ajax.runEval("/script/chooseEvent.exe?eventApprove&" + eventCode);
	if (eval(approveEvent.errorCode) == 0) {
		alert("Одобрено! ");
		document.getElementById("event" + eventCode).innerHTML = "<font size=\"2\"><a href=\"javascript:eventBanShow(" + eventCode + ");\">"  + "Запретить к показу" + "</a></font>";
	}
	else {
		alert("Произошла ошибка при одобрении мероприятия! ");
	}
}

//Запретить мероприятие к показу
function eventBanShow(eventCode)
{
	var banShowEvent = Ajax.runEval("/script/chooseEvent.exe?eventBanShow&" + eventCode);
	if (eval(banShowEvent.errorCode) == 0) {
		alert("Запрещено к показу! ");
		document.getElementById("event" + eventCode).innerHTML = "<font size=\"2\"><a href=\"javascript:eventApprove(" + eventCode + ");\">"  + "Одобрить" + "</a></font>";
	}
	else {
		alert("Произошла ошибка при запрещении к показу мероприятия! ");
	}
}

//Удалить мероприятие
function eventRemove(eventCode)
{
	if (window.confirm("Вы уверены, что хотите удалить данное мероприятие? ")) {	
		var result = Ajax.runEval("/script/chooseEvent.exe?eventRemove&" + eventCode);
		if (eval(result.errorCode) == 0) {
			alert("Мероприятие успешно удалено! ");
			location.reload();
		}
		else {
			alert("Произошла ошибка при удалении мероприятия! ");
		}
	}
}


</script>




</head>


	<body onload="javascript:onLoad();" style="background-size: 100% auto" bgcolor="#DCF7FF">

		

<div align="center">
	&nbsp;<table border="0" width="1844" id="table6">
		<tr>
			<td align="right" valign="top" width="191">&nbsp;</td>
			<td align="left" width="149">
			<p style="margin-top: 0; margin-bottom: 0">
			<img border="0" src="img/coat_of_arms_SO.gif" width="149" height="148"></td>
			<td align="left" valign="top" width="1490">
			<p align="center" style="margin-top: 0; margin-bottom: 0"><b>
			<font style="font-size: 23pt">Самарская 
			научно-образовательная программа
			<span style="font-size: 23pt">«ВЗЛЕТ»</span></font></b></p>
			<p align="center" style="margin-top: 0; margin-bottom: 0"><b>
			<font style="font-size: 23pt">конкурсного отбора школьников в
			<span style="font-size: 23pt">
			Губернаторский реестр</span></font></b></p>
			<p align="center" style="margin-top: 0; margin-bottom: 0"><b>
			<font style="font-size: 23pt"><span style="font-size: 23pt">
			творчески одаренной молодежи</span></font></b></p>
			<p align="center" style="margin-top: 0; margin-bottom: 0"><b>
			<font style="font-size: 23pt">
			<span style="font-size: 23pt">в сфере науки и техники&nbsp; </span>
			</font></b></p>
			<p style="margin-top: 0; margin-bottom: 0">&nbsp;</td>
		</tr>
	</table>

		<table width="84%" id="table11" border="0" cellpadding="0" align="center">
	<tr>
 		<!--<td align="center" style="font-size: 150%"><a href="conf/2014/index.htm">Международная научно-практическая конференция "ТВОРЧЕСКИЙ ПОТЕНЦИАЛ-2014"</a></td> -->
		<!--<td align="center" style="font-size: 150%"><a href="regionalConferences.htm">Региональная коференция "ТВОРЧЕСКИЙ ПОТЕНЦИАЛ-2014" ИСТ СГАСУ</a></td> -->		
		<!-- <td align="center" style="font-size: 150%"><a href="#">Архив исследовательской проектов школьников и студентов - участников АСВ (в разработке)</a></td> -->
		<td align="center" style="font-size: 150%" width="1%">
		<span style="font-size: 16pt">
		<div align="center">
			<table border="0" width="100%" id="table12">
				<tr>
					<td align="center">
					<p style="margin-top: 0; margin-bottom: 0"><b>
					<a href="index.html">Главная</a></b></td>
					<!--<td align="center">
					<p style="margin-top: 0; margin-bottom: 0"><b>
					<a href="about.html">О программе &quot;ВЗЛЕТ&quot;</a></b></td>-->
					<td align="center">
					<p style="margin-top: 0; margin-bottom: 0"><b>
					<a href="allUsers.htm">Участники программы</a></b></td>
					<td align="center">
					<a href="enterInfo.htm"><p style="margin-top: 0; margin-bottom: 0"><b>
					Ввод тематики<span lang="ru">,</span> запросов<span lang="ru">,</span> 
					коллективов</b></a></td>
					<td align="center">
					<p style="margin-top: 0; margin-bottom: 0"><b>
					<a href="chooseTheme.htm">Выбор тематики и&nbsp;формирование 
					коллективов</a></b></td>
					<td align="center">
					<p style="margin-top: 0; margin-bottom: 0">
					<span lang="ru">
					<a href="viewEnter.htm"><b>Просмотр 
					и ввод информации о ходе исследования</b></a></td>
					<td align="center" bgcolor="#FFFF00">
					<span style="font-size: 12pt">
					<p style="margin-top: 0; margin-bottom: 0"><b>
					<a href="events.htm">Запишись и участвуй</a></b></td>
					<td align="center">
					<p style="margin-top: 0; margin-bottom: 0"><b>
					<a href="monitoringThemes.htm">Мониторинг хода&nbsp;исследований</a></b></td>
					<td align="center">
					<p style="margin-top: 0; margin-bottom: 0"><b>
					<a href="contest.html">Региональный конкурс &quot;ВЗЛЕТ&quot;</a></b></td>
					<td align="center">
					<p style="margin-top: 0; margin-bottom: 0">
					<span style="font-size: 12pt">
					<b>
					<a href="enterInfo1.htm">Достижения в других 
					конкурсах/конференциях</a></b></td>
				</tr>
			</table>
		</div>
		</td>
	</tr>
</table>
	
	
	<div class="currentUser">
					<p style="margin-left: 100px; margin-right: 100px" align="right">
					<font color="#FFFFFF"><b>
					<span style="font-size: 12pt; background-color: #000080" id="currentUser">0</span></b></font><span style="font-size: 16pt">
				</div>

	
	
	<p style="margin-top: 0; margin-bottom: 0">&nbsp;</div>
		<div align="center">
			<table border="1" width="90%" id="table3">
				<tr>
					<td width="60%" align="left" valign="top">
	<p align="center"><font size="3">
	<span style="font-weight: 400"><span lang="ru">И</span>спользуйте фильтр для 
	целенаправленного поиска. <span lang="ru">В нем можно указать интересующую 
	Вас отрасль науки, статус тем и прочее.</span> <span lang="ru">Коллектив - 
	это содружество &quot;ученик-руководитель(учитель) - консультант (ученый вуза)&quot;.
	</span></span></font></p>
	<p align="center"><font size="3">
	<span lang="ru" style="font-weight: 400">Щелкнув по названию столбца, можно лексемографически упорядочить информацию.</span></font></p><span style="font-size: 16pt">
				<p align="center"><font color="#FF0000"><b><span lang="ru">
				ФИЛЬТР НЕ РАБОТАЕТ ПРИ ОБРАЩЕНИИ К САЙТУ ИЗ БРАУЗЕРА </span>
				INTERNET EXPLORER</b></font></p></span>
	<div align="center">
		<table border="1" width="60%" id="table4" bgcolor="#FFAE5E">
			<tr>
				<td align="left" valign="top" width="363">
				<p align="center"><span lang="ru">Отрасль науки</span></td>
				<td align="left" valign="top" width="323">
				<p align="center">Организация</td>
				<td align="left" valign="top" width="363">&nbsp;</td>
			</tr>
			<tr>
				<td align="left" valign="top" width="363">
				<p align="center">
				<select id="scienceDirection" size="1" name="D1">
				<option selected value="0">Все</option></select></td>
				<td align="left" valign="top" width="323">
				<p align="center">
				<select id="organization" size="1" name="D2">
				<option selected value="0">Все</option></select></td>
				<td align="left" valign="top" width="363">
				<input type="button" value="Показать" name="B3" onclick="chooseEvent();" style="float: right"></td>
			</tr>
		</table>
					<p align="center">
					<font style="font-size: 14pt"><b>


					<span lang="ru">Модерирование мероприятий</span></b></font></p>
		<p align="center">
					<span style="font-size: 12pt; font-style: italic">Чтобы 
					<span lang="ru">включиться в выполнение предлагаемого 
					проекта, необходимо щелкнуть по названию темы и ввести 
					необходимую информацию. При этом пользователь должен быть
					<a href="regUser.htm">зарегистрирован</a></span> </span></p>
		<p><span id="events">1</span><p>&nbsp;</div>
					<p>&nbsp;</td>
				</tr>
			</table>
	</div>
	<p align="center">&nbsp;</p>
	<p align="center">&nbsp;</p>
	</div>



</body>

</html>